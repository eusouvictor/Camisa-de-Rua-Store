generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  name     String?
  createdAt DateTime @default(now())
  products Product[]
  refreshTokens RefreshToken[]
  orders        Order[]
  role          String   @default("CUSTOMER")
}

model Product {
  id        Int     @id @default(autoincrement())
  nome      String
  preco     Float
  categoria String?
  ownerId   Int?
  owner     User?   @relation(fields: [ownerId], references: [id])
  createdAt DateTime @default(now())
  orderItems OrderItem[]
  description String?
  imageUrl    String?
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  revoked   Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())
}

// Este é o código para criar a tabela 'Order' de Huan
model Order {
  id             Int      @id @default(autoincrement())
  status         String   @default("PENDING") // Um pedido começa como pendente
  total          Float
  payment_method String? // '?' significa que é opcional

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt // O Prisma atualiza isso sozinho

  // Esta é a "ligação" importante:
  // Um Pedido (Order) pertence a um Usuário (User)
  user   User   @relation(fields: [userId], references: [id])
  userId Int

  // Um Pedido (Order) pode ter vários Itens (OrderItem)
  items OrderItem[]
}

// Este é o código para criar a tabela 'order_item' de Huan
model OrderItem {
  id        Int      @id @default(autoincrement())
  
  product_name String
  product_size String?
  unit_price   Float
  quantity     Int
  subtotal     Float // (Provavelmente unit_price * quantity)

  createdAt DateTime @default(now())
  
  // Ligação: Este item pertence a um Pedido (Order)
  order   Order  @relation(fields: [orderId], references: [id])
  orderId Int

  // Ligação: Este item é de um Produto (Product)
  product   Product @relation(fields: [productId], references: [id])
  productId Int
}